<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kehadiran Siswa</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f4f6f8; margin:0 }
header { background:#1e88e5; color:white; padding:20px; text-align:center }
.container { padding:20px }
input, button {
  width:100%; padding:10px; margin-top:10px;
  border-radius:6px; border:1px solid #ccc
}
button { background:#1e88e5; color:white; border:none }
.card {
  background:white; padding:15px; margin-top:15px; border-radius:8px
}
.status { font-weight:bold }
.Hadir { color:green }
.Izin { color:orange }
.Alpha { color:red }
</style>
</head>

<body>

<header>
<h2>üìÖ Cek Kehadiran Siswa</h2>
<a href="index.html" style="color:white">‚Üê Kembali</a>
</header>

<div class="container">
  <input id="kode" placeholder="Masukkan Kode Orang Tua">
  <button onclick="cek()">Lihat Kehadiran</button>
  <div id="hasil"></div>
</div>

<script>
// üîπ ubah DD/MM/YYYY ‚Üí Date
function parseTanggal(tgl) {
  const [d,m,y] = tgl.split("/");
  return new Date(`${y}-${m}-${d}`);
}

async function cek() {
  const kode = document.getElementById("kode").value.trim();
  const res = await fetch("data/kehadiran.csv");
  const text = await res.text();

  let data = [];
  const rows = text.split("\n").slice(1);

  rows.forEach(r => {
    if (!r.trim()) return;

    const kolom = r.split(";").map(x => x.trim());
    if (kolom.length < 4) return;

    const [k, nama, tanggal, status] = kolom;

    if (k === kode) {
      data.push({
        nama,
        tanggal,
        status,
        dateObj: parseTanggal(tanggal)
      });
    }
  });

  if (data.length === 0) {
    document.getElementById("hasil").innerHTML =
      "<p>Data tidak ditemukan</p>";
    return;
  }

  // üî• URUTKAN: TERBARU ‚Üí TERLAMA
  data.sort((a,b) => b.dateObj - a.dateObj);

  let output = `<div class="card"><b>${data[0].nama}</b></div>`;

  data.forEach(d => {
    output += `
      <div class="card">
        ${d.tanggal}<br>
        <span class="status ${d.status}">${d.status}</span>
      </div>
    `;
  });

  document.getElementById("hasil").innerHTML = output;
}
</script>

</body>
</html>
