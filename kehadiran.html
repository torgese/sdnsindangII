<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daftar Kehadiran</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 16px;
}

h2 {
    text-align: center;
    margin-bottom: 12px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    font-size: 14px;
}

th {
    background: #1d4ed8;
    color: #fff;
    position: sticky;
    top: 0;
}

tr:nth-child(even) {
    background: #f1f5f9;
}

.empty {
    text-align: center;
    padding: 16px;
    color: #666;
}

@media (max-width:600px) {
    th, td {
        font-size: 12px;
        padding: 8px;
    }
}
</style>
</head>

<body>

<h2>üìã Daftar Kehadiran (Terbaru)</h2>

<table>
<thead>
<tr>
    <th>Tanggal</th>
    <th>Kode</th>
    <th>Nama</th>
    <th>Status</th>
</tr>
</thead>
<tbody id="data">
<tr><td colspan="4" class="empty">Memuat data...</td></tr>
</tbody>
</table>

<script>
function parseTanggal(tgl) {
    // Support: MM/DD/YY & MM/DD/YYYY
    const p = tgl.split('/');
    if (p.length !== 3) return null;

    let year = p[2].length === 2 ? '20' + p[2] : p[2];
    return new Date(`${year}-${p[0].padStart(2,'0')}-${p[1].padStart(2,'0')}`);
}

fetch('kehadiran.csv')
.then(r => r.text())
.then(text => {
    const lines = text.trim().split('\n');
    let data = [];

    lines.forEach(line => {
        const c = line.split(';');

        // Skip header & baris rusak
        if (c.length !== 4) return;
        if (c[0].toLowerCase() === 'kode') return;

        const tglObj = parseTanggal(c[2]);
        if (!tglObj) return;

        data.push({
            kode: c[0],
            nama: c[1],
            tanggalText: c[2],
            tanggalObj: tglObj,
            status: c[3]
        });
    });

    // SORT TERBARU
    data.sort((a, b) => b.tanggalObj - a.tanggalObj);

    const tbody = document.getElementById('data');
    tbody.innerHTML = '';

    if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="empty">Data tidak ditemukan</td></tr>`;
        return;
    }

    data.forEach(d => {
        tbody.innerHTML += `
        <tr>
            <td>${d.tanggalText}</td>
            <td>${d.kode}</td>
            <td>${d.nama}</td>
            <td>${d.status}</td>
        </tr>`;
    });
})
.catch(err => {
    document.getElementById('data').innerHTML =
        `<tr><td colspan="4" class="empty">‚ùå Gagal membaca CSV</td></tr>`;
});
</script>

</body>
</html>
